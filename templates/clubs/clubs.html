{% extends "base.html" %}
{% load static %}

{% block title %}Club | CSE{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/clubs.css' %}">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
    <div class="banner-global">
        <h1 class="gradient-text-global">Explore All Clubs</h1>
    </div>
    <div style="background-image: linear-gradient(135deg, #f3e8ff, #e6e6fa, #ede1ff, #f8f0ff);">
        <p class="club-description">
            Discover a variety of clubs, connect with like-minded individuals, and engage in exciting activities that
            match your interests!
        </p>
    </div>

    <div class="custom-card-container">
        {% if clubs %}
            {% for club in clubs %}
                <div class="custom-card" data-club-name="{{ club.name|lower|slugify }}">
                    <div class="floating-elements"></div>

                    <img src="{{ club.logo.url }}" alt="{{ club.name }} Logo" class="custom-card-logo">
                    <p class="custom-card-text">{{ club.name }}</p>
                    <a href="#modal-{{ club.id }}" class="custom-read-more">Learn More</a>
                </div>

                <!-- Modal for this club -->
                <div id="modal-{{ club.id }}" class="modal">
                    <div class="modal-content">
                        <a href="#" class="close-modal">&times;</a>
                        <div class="modal-cover">
                            <img src="{{ club.cover_picture.url }}" alt="{{ club.name }} Cover">
                            <div class="modal-logo-container">
                                <img src="{{ club.logo.url }}" alt="{{ club.name }} Logo" class="modal-logo">
                            </div>
                        </div>
                        <div class="modal-header">
                            <h2 class="modal-title">{{ club.name }}</h2>
                            <p class="modal-motto">{{ club.moto }}</p>
                        </div>

                        <div class="modal-body">
                            {% if club.convener %}
                                <p class="convener-info">
                                    Convened by <br>
                                    <a href="{% url 'faculty_detail' club.convener.id %}" class="convener-link">
                                        {{ club.convener.name }}
                                    </a>
                                </p>
                            {% endif %}

                            <p class="club-description">{{ club.description }}</p>

                            {% if club.members.exists %}
                                <div class="club-members">
                                    <h3 class="members-title">Meet the Panel</h3>
                                    <div class="members-list">
                                        {% for member in club.members.all %}
                                            <div class="member-card">
                                                <div class="member-photo">
                                                    {% if member.profile_picture %}
                                                        <img src="{{ member.profile_picture.url }}" alt="{{ member.user.get_full_name }}'s Photo">
                                                    {% else %}
                                                        <img src="{% static 'defaults/default-profile.png' %}" alt="Default Profile Picture">
                                                    {% endif %}
                                                </div>
                                                <div class="member-info">
                                                    <p class="member-name">
                                                        {% if member.user.first_name or member.user.last_name %}
                                                            {{ member.user.first_name }} {{ member.user.last_name }}
                                                        {% else %}
                                                            {{ member.user.username }}
                                                        {% endif %}
                                                    </p>
                                                    <p class="member-email"><a href="mailto:{{ member.email }}">{{ member.email }}</a></p>
                                                    <p class="member-position">{{ member.position }}</p>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% else %}
                                <p>No members found for this club.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
<script>
const floatingIconsMap = {
    'software-hardware-club-cse-uap': ['fa-solid fa-laptop', 'fa-solid fa-screwdriver-wrench', 'fa-solid fa-gear'],
    'cse-cultural-club-uap': ['fa-solid fa-masks-theater', 'fa-solid fa-palette', 'fa-solid fa-music'],
};

const directions = ['float-up', 'float-down', 'float-diagonal'];

document.querySelectorAll('.custom-card').forEach(card => {
    const clubKey = card.dataset.clubName;
    const container = card.querySelector('.floating-elements');
    if (!floatingIconsMap[clubKey]) return;

    const icons = floatingIconsMap[clubKey];
    const containerHeight = container.clientHeight;
    const containerWidth = container.clientWidth;
    const maxIcons = 5;

    function createFloatingIcon() {
        const iconClass = icons[Math.floor(Math.random() * icons.length)];
        const directionClass = directions[Math.floor(Math.random() * directions.length)];

        const icon = document.createElement('i');
        icon.className = `${iconClass} floating-icon ${directionClass}`;

        const size = 1 + Math.random() * 1.2;
        icon.style.fontSize = `${size}rem`;

        // Random position inside the container
        icon.style.left = `${Math.random() * (containerWidth - 30)}px`;
        icon.style.top = `${Math.random() * (containerHeight - 30)}px`;

        container.appendChild(icon);
icon.addEventListener('click', () => {
    icon.classList.add('flicker-pop');
    icon.style.pointerEvents = 'none'; // prevent double clicks
    setTimeout(() => icon.remove(), 500); // remove after effect
});

        // Auto remove after animation
        setTimeout(() => {
            icon.remove();
            createFloatingIcon(); // respawn continuously
        }, 8000);
    }

    // Initial icon spawn
    for (let i = 0; i < maxIcons; i++) {
        setTimeout(() => createFloatingIcon(), i * 1500); // staggered entry
    }
});
</script>

{% endblock %}